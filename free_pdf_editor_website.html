<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free PDF Text Editor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        #pdfCanvas {
            border: 1px solid #000;
            margin-top: 10px;
            width: 80%;
        }
        #textEdit {
            width: 80%;
            height: 150px;
            margin-top: 10px;
        }
        button {
            padding: 10px 20px;
            margin-top: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Free PDF Text Editor</h1>
    <input type="file" id="pdfUpload" accept="application/pdf">
    <canvas id="pdfCanvas"></canvas>
    <textarea id="textEdit" placeholder="Edit PDF text here..."></textarea>
    <button id="savePdf">Save PDF</button>

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>

    <script>
        const pdfUpload = document.getElementById('pdfUpload');
        const pdfCanvas = document.getElementById('pdfCanvas');
        const ctx = pdfCanvas.getContext('2d');
        const textEdit = document.getElementById('textEdit');
        const savePdf = document.getElementById('savePdf');

        let pdfDoc = null;
        let currentPage = 1;

        pdfUpload.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file.type !== 'application/pdf') {
                alert('Please upload a PDF file!');
                return;
            }

            const fileReader = new FileReader();
            fileReader.onload = async function() {
                const typedArray = new Uint8Array(this.result);
                pdfDoc = await pdfjsLib.getDocument(typedArray).promise;
                renderPage(currentPage);
            };
            fileReader.readAsArrayBuffer(file);
        });

        async function renderPage(pageNumber) {
            const page = await pdfDoc.getPage(pageNumber);
            const viewport = page.getViewport({ scale: 1.5 });
            pdfCanvas.height = viewport.height;
            pdfCanvas.width = viewport.width;

            const renderContext = {
                canvasContext: ctx,
                viewport: viewport
            };
            await page.render(renderContext).promise;

            const textContent = await page.getTextContent();
            textEdit.value = textContent.items.map(i => i.str).join(' ');
        }

        savePdf.addEventListener('click', async () => {
            const pdfBytes = await pdfUpload.files[0].arrayBuffer();
            const pdfDocEdit = await PDFLib.PDFDocument.load(pdfBytes);
            const pages = pdfDocEdit.getPages();
            const firstPage = pages[0];
            firstPage.drawText(textEdit.value, { x: 50, y: 500, size: 12 });

            const pdfDataUri = await pdfDocEdit.saveAsBase64({ dataUri: true });
            const a = document.createElement('a');
            a.href = pdfDataUri;
            a.download = 'edited.pdf';
            a.click();
        });
    </script>
</body>
</html>
